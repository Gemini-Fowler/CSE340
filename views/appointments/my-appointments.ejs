<%- include('../partials/head') %>

    <body>
        <%- include('../partials/header') %>
            <%- include('../partials/navigation') %>

                <main>
                    <h1>
                        <%= title %>
                    </h1>

                    <% if (typeof messages !=='undefined' && messages.notice) { %>
                        <div class="alert alert-notice">
                            <%= messages.notice %>
                        </div>
                        <% } %>

                            <% if (typeof messages !=='undefined' && messages.error) { %>
                                <div class="alert alert-danger">
                                    <%= messages.error %>
                                </div>
                                <% } %>

                                    <div class="appointments-container">
                                        <% if (appointments && appointments.length> 0) { %>
                                            <table class="appointments-table">
                                                <thead>
                                                    <tr>
                                                        <th>Vehicle</th>
                                                        <th>Date</th>
                                                        <th>Time</th>
                                                        <th>Status</th>
                                                        <th>Notes</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% appointments.forEach(appointment=> { %>
                                                        <tr>
                                                            <td>
                                                                <img src="<%= appointment.inv_thumbnail %>"
                                                                    alt="<%= appointment.inv_make %> <%= appointment.inv_model %>"
                                                                    class="appointment-thumb">
                                                                <a href="/inv/detail/<%= appointment.inv_id %>">
                                                                    <%= appointment.inv_year %>
                                                                        <%= appointment.inv_make %>
                                                                            <%= appointment.inv_model %>
                                                                </a>
                                                            </td>
                                                            <td>
                                                                <%= new
                                                                    Date(appointment.appointment_date).toLocaleDateString()
                                                                    %>
                                                            </td>
                                                            <td>
                                                                <%= appointment.appointment_time %>
                                                            </td>
                                                            <td>
                                                                <span
                                                                    class="status-badge status-<%= appointment.status %>">
                                                                    <%= appointment.status %>
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <%= appointment.notes || 'N/A' %>
                                                            </td>
                                                            <td>
                                                                <% if (appointment.status==='scheduled' ) { %>
                                                                    <form action="/appointments/cancel" method="post"
                                                                        class="inline-form">
                                                                        <input type="hidden" name="appointment_id"
                                                                            value="<%= appointment.appointment_id %>">
                                                                        <button type="submit"
                                                                            class="btn btn-danger btn-sm"
                                                                            onclick="return confirm('Are you sure you want to cancel this appointment?')">
                                                                            Cancel
                                                                        </button>
                                                                    </form>
                                                                    <% } else { %>
                                                                        <span class="text-muted">-</span>
                                                                        <% } %>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                            <% } else { %>
                                                <p class="notice">You have no appointments scheduled. Browse our <a
                                                        href="/inv">inventory</a> to schedule a test drive!</p>
                                                <% } %>
                                    </div>
                </main>

                <%- include('../partials/footer') %>
    </body>

    </html>